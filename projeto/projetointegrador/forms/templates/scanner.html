<h1>Scanner para {{ event.name }}</h1>
<p>Use a câmera para escanear o QR Code do participante.</p>

<!-- Div onde o scanner será exibido -->
<div id="reader" style="width: 300px; height: 300px; margin-bottom: 20px;"></div>

<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<script>
    function onScanSuccess(qrCodeMessage) {
        // Quando o QR Code for lido, envie os dados para o backend
        fetch('', {  // Envia para a mesma rota
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'  // Inclua o token CSRF
            },
            body: JSON.stringify({ qr_data: qrCodeMessage })  // Envia os dados do QR Code
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);  // Mostra a mensagem de validação no frontend
        })
        .catch(error => console.error('Erro:', error));
    }

    function onScanError(errorMessage) {
        // Tratamento para erros no scanner
        console.warn('Erro no scanner:', errorMessage);
    }

    // Inicializa o scanner
    const html5QrCode = new Html5Qrcode("reader");
    const config = { fps: 10, qrbox: { width: 250, height: 250 } };  // Configurações do scanner

    html5QrCode.start(
        { facingMode: "environment" },  // Usa a câmera traseira
        config,
        onScanSuccess,
        onScanError
    );
</script>
